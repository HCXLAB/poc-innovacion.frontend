<!-- Main -->
<div class="flex flex-auto p-6 sm:p-10">
    <div class="mx-auto flex w-full max-w-xs flex-auto flex-col sm:max-w-5xl">
        <!-- Filters -->
        <div
            class="flex w-full max-w-xs flex-col items-center justify-between sm:max-w-none sm:flex-row"
        >
            <mat-form-field
                class="w-full sm:w-36"
                [subscriptSizing]="'dynamic'"
            >
                <mat-select
                    [value]="'all'"
                    (selectionChange)="filterByCategory($event)"
                >
                    <mat-option [value]="'all'">Todo</mat-option>
                    @for (
                        category of categories;
                        track trackByFn($index, category)
                    ) {
                        <mat-option [value]="category.slug">{{
                            category.title
                        }}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
            <mat-form-field
                class="mt-4 w-full sm:ml-4 sm:mt-0 sm:w-72"
                [subscriptSizing]="'dynamic'"
            >
                <mat-icon
                    matPrefix
                    class="icon-size-5"
                    [svgIcon]="'heroicons_solid:magnifying-glass'"
                ></mat-icon>
                <input
                    (input)="filterByQuery(query.value)"
                    placeholder="Buscar por titulo o descripciÃ³n"
                    matInput
                    #query
                />
            </mat-form-field>
            <mat-slide-toggle
                class="mt-8 sm:ml-auto sm:mt-0"
                [color]="'primary'"
                (change)="toggleCompleted($event)"
            >
                Ideas aprovadas
            </mat-slide-toggle>
        </div>
        <!-- Courses -->
        @if (this.filteredCourses.length) {
            <div
                class="mt-8 grid grid-cols-1 gap-8 sm:mt-10 sm:grid-cols-2 lg:grid-cols-3"
            >
                @for (
                    course of filteredCourses;
                    track trackByFn($index, course)
                ) {
                    <!-- Course -->
                    <div
                        class="bg-card flex h-96 flex-col overflow-hidden rounded-2xl shadow"
                    >
                        <div class="flex flex-col p-6">
                            <div class="flex items-center justify-between">
                                <!-- Course category -->
                                @if (
                                    course.category
                                        | fuseFindByKey: 'slug' : categories;
                                    as category
                                ) {
                                    <div
                                        class="rounded-full px-3 py-0.5 text-sm font-semibold"
                                        [ngClass]="{
                                            'bg-blue-100 text-blue-800 dark:bg-blue-500 dark:text-blue-50':
                                                category.slug === 'IA',
                                            'bg-green-100 text-green-800 dark:bg-green-500 dark:text-green-50':
                                                category.slug === 'Web',
                                            'bg-pink-100 text-pink-800 dark:bg-pink-500 dark:text-pink-50':
                                                category.slug === 'Accesos',
                                            'bg-amber-100 text-amber-800 dark:bg-amber-500 dark:text-amber-50':
                                                category.slug === 'firebase',
                                        }"
                                    >
                                        {{ category.title }}
                                    </div>
                                }
                                <!-- Completed at least once -->
                                <div class="flex items-center">
                                    @if (course.progress.completed > 0) {
                                        <mat-icon
                                            class="text-green-600 icon-size-5"
                                            [svgIcon]="
                                                'heroicons_solid:check-badge'
                                            "
                                            [matTooltip]="
                                                'Se ha aprobado esta idea'
                                            "
                                        ></mat-icon>
                                    }
                                </div>
                            </div>
                            <!-- Course title & description -->
                            <div class="mt-4 text-lg font-medium">
                                {{ course.title }}
                            </div>
                            <div class="text-secondary mt-0.5 line-clamp-2">
                                {{ course.description }}
                            </div>
                            <div class="my-6 h-1 w-12 border-t-2"></div>
                            <!-- Course time -->
                            <div
                                class="text-secondary flex items-center text-md leading-5"
                            >
                                <mat-icon
                                    class="text-hint icon-size-5"
                                    [svgIcon]="'heroicons_solid:clock'"
                                ></mat-icon>
                                <div class="ml-1.5">
                                    {{ course.date }}
                                </div>
                            </div>
                            <!-- Course completion -->
                            <div
                                class="text-secondary mt-2 flex items-center text-md leading-5"
                            >
                                <mat-icon
                                    class="text-hint icon-size-5"
                                    [svgIcon]="'heroicons_solid:hand-thumb-up'"
                                ></mat-icon>
                                @if (course.progress.completed === 0) {
                                    <div class="ml-1.5">Never completed</div>
                                }
                                @if (course.progress.completed > 0) {
                                    <div class="ml-1.5">
                                        <span class="ml-1">
                                            <!-- Once -->
                                            @if (
                                                course.progress.completed === 1
                                            ) {
                                                17
                                            }
                                            <!-- Twice -->
                                            @if (
                                                course.progress.completed === 2
                                            ) {
                                                twice
                                            }
                                            <!-- Others -->
                                            @if (
                                                course.progress.completed > 2
                                            ) {
                                                {{ course.progress.completed }}
                                                {{
                                                    course.progress.completed
                                                        | i18nPlural
                                                            : {
                                                                  '=0': 'time',
                                                                  '=1': 'time',
                                                                  other: 'times',
                                                              }
                                                }}
                                            }
                                        </span>
                                    </div>
                                }
                                <mat-icon
                                    class="text-hint icon-size-5"
                                    [svgIcon]="
                                        'heroicons_solid:hand-thumb-down'
                                    "
                                ></mat-icon>
                                3
                            </div>
                        </div>
                        <!-- Footer -->
                        <div class="mt-auto flex w-full flex-col">
                            <!-- Course progress -->
                            <div class="relative h-0.5">
                                <div
                                    class="absolute inset-x-0 z-10 -mt-3 h-6"
                                    [matTooltip]="
                                        course.progress.currentStep /
                                            course.totalSteps | percent
                                    "
                                    [matTooltipPosition]="'above'"
                                    [matTooltipClass]="'-mb-0.5'"
                                ></div>
                                <mat-progress-bar
                                    class="h-0.5"
                                    [value]="
                                        (100 * course.progress.currentStep) /
                                        course.totalSteps
                                    "
                                ></mat-progress-bar>
                            </div>

                            <!-- Course launch button -->
                            <div
                                class="bg-gray-50 px-6 py-4 text-right dark:bg-transparent"
                            >
                                <a
                                    mat-stroked-button
                                    [routerLink]="[
                                        '/publicaciones/',
                                        course.id,
                                    ]"
                                >
                                    <span class="inline-flex items-center">
                                        <!-- Not started -->
                                        @if (
                                            course.progress.currentStep === 0
                                        ) {
                                            <!-- Never completed -->
                                            @if (
                                                course.progress.completed === 0
                                            ) {
                                                <span>Start</span>
                                            }
                                            <!-- Completed before -->
                                            @if (
                                                course.progress.completed > 0
                                            ) {
                                                <span>Start again</span>
                                            }
                                        }

                                        <!-- Started -->
                                        @if (course.progress.currentStep > 0) {
                                            <span>Ver</span>
                                        }

                                        <mat-icon
                                            class="ml-1.5 icon-size-5"
                                            [svgIcon]="
                                                'heroicons_solid:arrow-small-right'
                                            "
                                        ></mat-icon>
                                    </span>
                                </a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        } @else {
            <div
                class="flex flex-auto flex-col items-center justify-center bg-gray-100 dark:bg-transparent"
            >
                <mat-icon
                    class="icon-size-24"
                    [svgIcon]="'heroicons_outline:document-search'"
                ></mat-icon>
                <div
                    class="text-secondary mt-6 text-2xl font-semibold tracking-tight"
                >
                    No tienes Ideas
                </div>
            </div>
        }

        <!-- No courses -->
    </div>
</div>

